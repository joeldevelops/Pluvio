<?xml version="1.0"?>
<vxml version = "2.1" xmlns="http://www.w3.org/2001/vxml">
<property name="inputmodes" value="dtmf"/>
  <form>
    <block>
      <prompt>
        Welcome to Pluvio, a voice service to enter or receive rainfall information.
      </prompt>
      <goto next="#lang"/>
    </block>
  </form>

  <menu id="lang">
    <prompt>
      For English, press 1.
      For French, press 2.
    </prompt>
    <choice dtmf="1" next="#mainmenu">
       English</choice>
    <choice dtmf="2" next="#mainmenufr">
       French</choice>
  </menu>

  <menu id="mainmenu">
    <prompt>
      For Mali, press 1.
      For Burkina Faso, press 2.
    </prompt>
    <choice dtmf="1" next="#mali">
       Mali</choice>
    <choice dtmf="2" next="#bf">
       Burkina Faso</choice>
  </menu>

  <form id="mali">
    <block>
      <prompt>You selected Mali.</prompt>
      <goto next="#secondmenumali"/>
    </block>
  </form>

  <form id="bf">
    <block>
      <prompt>You selected Burkina Faso</prompt>
      <goto next="#secondmenufaso"/>
    </block>
  </form>

  <menu id="secondmenumali">
    <prompt>
      To enter rainfall measurements, press 1.
      To receive rainfall information, press 2.
    </prompt>
    <choice dtmf="1" next="#entermali">
       Enter measurements</choice>
    <choice dtmf="2" next="#receivemali">
       Receive information</choice>
  </menu>

  <menu id="secondmenufaso">
    <prompt>
      To enter rainfall measurements, press 1.
      To receive rainfall information, press 2.
    </prompt>
    <choice dtmf="1" next="#enterfaso">
       Enter measurements</choice>
    <choice dtmf="2" next="#receivefaso">
       Receive information</choice>
  </menu>

  <form id="entermali">
    <assign name="location" expr="'Mali'"/>
    <field name="amount" type="number">
      <prompt>You clicked 1: Enter measurements. Please enter your measurements in milliliters and end with a hashtag.</prompt>
    </field>
    <filled mode="all">
      <prompt>You entered <value expr="amount"/> milliliters</prompt>
      <submit next="https://pluvio-api.herokuapp.com/api/v1/rain" method="POST" namelist="amount"/>
    </filled>
  </form>

  <form id="receivemali">
    <block>
      <prompt>You clicked 2: Receive Information</prompt>
      <goto next="#thirdmenumali"/>
    </block>
  </form>

  <form id="receivefaso">
    <block>
      <prompt>You clicked 2: Receive Information</prompt>
      <goto next="#thirdmenufaso"/>
    </block>
  </form>

  <menu id="thirdmenumali">
    <prompt>
      To hear yesterday's measurements, press 1.
      To hear last week's total measurements, press 2.
    </prompt>
    <choice dtmf="1" next="#yesterdaymali">
       Yesterday</choice>
    <choice dtmf="2" next="https://pluvio-api.herokuapp.com/api/v1/rain/week?location=Mali">
       Last Week</choice>
  </menu>

  <form id="yesterdaymali">
    <block>
      <submit next="https://pluvio-api.herokuapp.com/api/v1/rain/day?location=Mali" method="GET"/>
    </block>
  </form>

  <menu id="thirdmenufaso">
    <prompt>
      To hear yesterday's measurements, press 1.
      To hear last week's total measurements, press 2.
    </prompt>
    <choice dtmf="1" next="https://pluvio-api.herokuapp.com
/api/v1/rain/day?location=Faso">
       Yesterday</choice>
    <choice dtmf="2" next="https://pluvio-api.herokuapp.com
/api/v1/rain/week?location=Faso">
       Last Week</choice>
  </menu>

  <menu id="mainmenufr">
    <prompt>
      <audio src="./audio_french/PourleMali.wav">
	Select 1 for Mali and 2 for Burkina Faso.
      </audio>
    </prompt>
    <choice dtmf="1" next="#Malifr">
       Mali</choice>
    <choice dtmf="2" next="#BFfr">
       Burkina Faso</choice>
  </menu>

   <form id="Malifr">
    <block>
      <prompt>
        <audio src="./audio_french/selectionneMali.wav">
	  You selected Mali.
        </audio>
      </prompt>
      <goto next="#secondmenufr"/>
    </block>
  </form>

  <form id="BFfr">
    <block>
      <prompt>
        <audio src="./audio_french/selectionneBurkina.wav">
	  You selected Burkina Faso.
        </audio>
      </prompt>
      <goto next="#secondmenufr"/>
    </block>
  </form>

  <menu id="secondmenufr">
    <prompt>
      <audio src="./audio_french/entermesures.wav">
	To enter rainfall measurements, press 1.
      	To receive rainfall information, press 2.
      </audio>
    </prompt>
    <choice dtmf="1" next="#enterfr">
       Enter measurements</choice>
    <choice dtmf="2" next="#receivefr">
       Receive information</choice>
  </menu>

  <form id="enterfr">
   <field name="measure" type="number">
    <prompt>
      <audio src="./audio_french/clickentrer.wav">
	You clicked 1: Enter measurements. Please enter your measurements in milliliters and end with a hashtag.
      </audio>
    </prompt>
    <filled>
	<assign name="ml" expr="measure"/>
	<prompt>You entered <value expr="ml"/> milliliters</prompt>
    </filled>
   </field>
  </form>

  <form id="receivefr">
    <block>
      <prompt>
        <audio src="./audio_french/click2.wav">
	  You clicked 2: Receive Information
        </audio>
      </prompt>
      <goto next="#thirdmenufr"/>
    </block>
  </form>

  <menu id="thirdmenufr">
    <prompt>
      <audio src="./audio_french/entendremesures.wav">
	To hear yesterday's measurements, press 1.
        To hear last week's total measurements, press 2.
      </audio>
    </prompt>
    <choice dtmf="1" next="#yesterdayfr">
       Yesterday</choice>
    <choice dtmf="2" next="#lastweekfr">
       Last Week</choice>
  </menu>

  <form id="yesterdayfr">
    <block>
      <prompt>Yesterday it rained 8 milliliters</prompt>
    </block>
  </form>

  <form id="lastweekfr">
    <block>
      <prompt>In the past week it rained 20 milliliters</prompt>
    </block>
  </form>

</vxml>
